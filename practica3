CentOs crear usario
    adduser username
    passwd username
    usermod -a -G wheel username

CentOs claves ssh
    mkdir -p ~/.ssh
    echo public_key_string >> ~/.ssh/authorized_keys
    chmod -R go= ~/.ssh

    -Glue records: A glue record provides the IP address of a nameserver so that the domain can be resolved in the case where the name server is hosted at the same domain as the domain name itself.
    Dan la @IP de un servidor de nombres para que se pueda resolver en el caso que este ubicado en el mismo dominio.


RED

orouter8
    /ETC/HOSTNAME/VLAN810
        !route add -inet6 2001:470:736b:811::/64 2001:470:736b::810::2
        !route add -inet6 2001:470:736b:812::/64 2001:470:736b::810::2



IPA1

    Configuración vlan811

        /ETC/SYSCONFIG/NETWORK-SCRIPTS/IFCFG-ETH0.811

            DEVICE=eth0.811
            ONBOOT=yes # es el método para iniciar su interfaz de red (sí - automático, No - manual)
            BOOTPROTO=none #es cómo se asigna una dirección IP (estático es un valor introducido manualmente, DHCP significa que la dirección IP se asigna automáticamente)
            IPV6INIT=yes
            IPV6ADDR=2001:470:736b:811::2/64
            IPV6_DEFAULTGW=2001:470:736b:811::1
            VLAN=yes

        /ETC/RESOLV.CONF
            nameserver 2001:470:736b:820::2  ##UNBOUND

        /ETC/SYSCONFIG/NETWORK-SCRIPTS/IFCFG-ETH0
IPA1-

    Configuración vlan811

        fichero /etc/sysconfig/network-scripts/ifcfg-eth0.811
chmod -R go= ~/.ssh
            DEVICE=eth0.811
            BOOTPROTO=static #es cómo se asigna una dirección IP (estático es un valor introducido manualmente, DHCP significa que la dirección IP se asigna automáticamente)

            ONBOOT=yes # es el método para iniciar su interfaz de red (sí - automático, No - manual)
            IP6ADDR=2001:470:736b:811::2
            PREFIX=64
            NETWORK=2001:470:736b:811::
            VLAN=yes




        fichero /etc/sysconfig/network-scripts/ifcfg-eth0

            IPV6_AUTOCONF="yes" => "no"

        /ETC/HOSTNAME
            ipa1

        /ETC/HOSTS
            127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
            ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
            2001:470:736b:811::2 ipa1.1.8.ff.es.eu.org
            2001:470:736b:811::3 ipa2.1.8.ff.es.eu.org

        /etc/resolv.conf
            nameserver ::1

        UNBOUND
        /VAR/NSD/ZONES/8.ff.es.eu.org.directo

            1 IN NS ipa1.1.8.ff.es.eu.org. ;delegación de subdominio

            ipa1.1.8.ff.es.eu.org. IN AAAA 2001:470:736b:811::2

        /VAR/NSD/ZONES/8.ff.es.eu.org.inverso

            1 IN NS ipa1.1.8.ff.es.eu.org. ;delegación de subdominio

            2.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.1.1 IN PTR ipa1.1.8.ff.es.eu.org.

    Chrony:ys

        /ETC/CHRONY.CONF
            server 2001:470:736b:820::2

    Configuración FreeIPA:

        ipa-server-install --uninstall
        Instalar paquetes ipa-server, bind, bind-dyndb-ldap, en CentOS

        yum install ipa-server
        yum install bind
        yum install bind-dyndb-ldap
        yum install ipa-server-dns
        ipa-server-install
        sudo ipa-server-install --domain-level 0

                The domain level indicates what operations and capabilities are available in the IdM topology.

                    Domain level 1:
                        simplified ipa-replica-install
                        enhaced topology management
                    Domain level 0:
                        ipa-replica-install requires a more complicated process of creating a replica information file on the initial server and copying to the replica
                        more complicated and error-prone topology management using ipa-replica-manage and ipa-csreplica-manage


        Do you want to configure integrated DNS (BIND)? [no]: yes
            domain name 1.8.ff.es.eu.org
            realm name 1.8.FF.ES.EU.ORG
        Do you want to configure DNS forwarders? [yes]: no
            A DNS forwarder is a Domain Name System (DNS) server on a network used to forward DNS queries for external DNS names to DNS servers outside of that network.
            El DNS Forwarder reenviará las solicitudes a otro solucionador de DNS si no “conoce” la respuesta. (por ejemplo, no tiene autoridad o no está en la caché), y si obtiene un resultado, lo almacenará en una caché rápida y ligera (no un solucionador) que requiere servidores DNS ascendentes para que las solicitudes posteriores puedan usar el resultado en caché hasta que expire el TTL (tiempo de vida).
        Do you want to search for missing reverse zones? [yes]: no
            The script prompts to check if any DNS reverse (PTR) records for the IP addresses associated with the server need to be configured. (Pero no las encuentra).
            Podemos usar un servicio DNS externo a este para esto.

        systemctl restart dbus


    ipa dnsrecord-find 1.8.ff.es.eu.org. --name ipa2
            ----------------------------
            Number of entries returned 0
            ----------------------------
            [a795809@ipa1 ~]$ ipa dnsrecord-add
            Record name: ipa2.1.8.ff.es.eu.org.
            Zone name: 1.8.ff.es.eu.org.
            Please choose a type of DNS resource record to be added
            The most common types for this type of zone are: A, AAAA

            DNS resource record type: AAAA
            AAAA IP Address: 2001:470:736b:811::3
            Record name: ipa2
            AAAA record: 2001:470:736b:811::3

    *Configuración FreeIPA REPLICA:
        - ipa-replica-prepare ipa2.1.8.ff.es.eu.org


        - scp /var/lib/ipa/replica-info-ipa2.1.8.ff.es.eu.org.gpg a795809@[2001:470:736b:811::3]:/home/a795809/


        yum install ipa-server
        yum install bind
        yum install bind-dyndb-ldap
        yum install ipa-server-dns
        ipa-server-install

        - ipa-replica-install replica-info-ipa2.1.8.ff.es.eu.org.gpg
        - ipa-dns-install
        - ipa dnsrecord-add
        - ipa dnszone-add 1.8.0.b.6.3.7.0.7.4.0.1.0.0.2.ip6.arpa.
        - ipa dnsrecord-add 1.8.0.b.6.3.7.0.7.4.0.1.0.0.2.ip6.arpa. 3.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.1 --ptr-rec ipa2.1.8.ff.es.eu.org.
        - ipa dnsrecord-add/del 1.8.0.b.6.3.7.0.7.4.0.1.0.0.2.ip6.arpa. 2.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.1 --ptr-rec ipa2.1.8.ff.es.eu.org.

        - ipa dnsrecord-add 1.8.ff.es.eu.org. nfs1 --aaaa-rec 2001:470:736b:811::4
        - ipa dnsrecord-add 1.8.0.b.6.3.7.0.7.4.0.1.0.0.2.ip6.arpa. 3.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.1 --ptr-rec nfs1.1.8.ff.es.eu.org.

        Cliente1 HAY QUE CAMBIARLO
        - ipa dnsrecord-add 1.8.ff.es.eu.org. cliente1 --aaaa-rec 2001:470:736b:812:5054:ff:fe08:1205
        - ipa dnsrecord-add 1.8.0.b.6.3.7.0.7.4.0.1.0.0.2.ip6.arpa. 5.0.2.1.8.0.e.f.f.f.0.0.4.5.0.5.2 --ptr-rec cliente1.1.8.ff.es.eu.org.

        Cliente2
        - ipa dnsrecord-add 1.8.ff.es.eu.org. cliente2 --aaaa-rec 2001:470:736b:812:5054:ff:fe08:1206
        - ipa dnsrecord-add 1.8.0.b.6.3.7.0.7.4.0.1.0.0.2.ip6.arpa. 6.0.2.1.8.0.e.f.f.f.0.0.4.5.0.5.2 --ptr-rec cliente2.1.8.ff.es.eu.org.


        ipa dnsrecord-find 1.8.ff.es.eu.org.
        ipa dnsrecord-find 1.8.0.b.6.3.7.0.7.4.0.1.0.0.2.ip6.arpa.

        hostnamectl set-hostname ipa2.1.8.ff.es.eu.org


    ipa user-find

        User login: admin
        Last name: Administrator
        Home directory:/home/admin
        Login shell: /bin/bash
        Principal alias: admin@1.8.FF.ES.EU.ORG
        UID: 845200000
        GID: 845200000
        Account disabled: False


    ipa user-add

        --------------------
        Added user "a795809"
        --------------------
        User login: a795809
        First name: Martina
        Last name: Universidad
        Full name: Martina Universidad
        Display name: Martina Universidad
        Initials: MU
        Home directory: /home/a795809
        GECOS: Martina Universidad
        Login shell: /bin/sh
        Principal name: a795809@1.8.FF.ES.EU.ORG
        Principal alias: a795809@1.8.FF.ES.EU.ORG
        Email address: a795809@1.8.ff.es.eu.org
        UID: 845200003
        GID: 845200003
        Password: False
        Member of groups: ipausers
        Kerberos keys available: False


        --------------------
        Added user "martina"
        --------------------
        User login: martina
        First name: MArtina
        Last name: Gracia
        Full name: MArtina Gracia
        Display name: MArtina Gracia
        Initials: MG
        Home directory: /home/martina
        GECOS: MArtina Gracia
        Login shell: /bin/sh
        Principal name: martina@1.8.FF.ES.EU.ORG
        Principal alias: martina@1.8.FF.ES.EU.ORG
        Email address: martina@1.8.ff.es.eu.org
        UID: 845200001
        GID: 845200001
        Password: False
        Member of groups: ipausers
        Kerberos keys available: False






orouter81

    Activación demonio rad:
        rcctl enable rad

    /ETC/RAD.CONF
        interface vlan812

o8cliente1

    /ETC/SYSCONFIG/NETWORK-SCRIPTS/IFCFG-ETH0.812

        DEVICE="eth0.812"
        ONBOOT="YES"
        BOOTPROTO="none"
        VLAN="yes"
        IPV6INIT="YES"

IPA2



    Configuración vlan811

        /ETC/SYSCONFIG/NETWORK-SCRIPTS/IFCFG-ETH0.811

            DEVICE=eth0.811
            ONBOOT=yes # es el método para iniciar su interfaz de red (sí - automático, No - manual)
            BOOTPROTO=none #es cómo se asigna una dirección IP (estático es un valor introducido manualmente, DHCP significa que la dirección IP se asigna automáticamente)
            IPV6INIT=yes
            IPV6ADDR=2001:470:736b:811::3/64
            IPV6_DEFAULTGW=2001:470:736b:811::1
            VLAN=yes

        /ETC/RESOLV.CONF
            nameserver 2001:470:736b:820::2 ##UNBOUND ESTO NO ESTA
            nameserver 2001:470:736b:811::2

        /ETC/SYSCONFIG/NETWORK-SCRIPTS/IFCFG-ETH0

            IPV6_AUTOCONF="yes" => "no"


    En el servidor FREEIPA
        ipa-replica-prepare esta permitido solo en domain 0
        sudo ipa-replica-prepare --ip-address=2001:470:736b:811::3 ipa2.1.8.ff.es.eu.org

NFS1

    Configuración vlan811

        /ETC/SYSCONFIG/NETWORK-SCRIPTS/IFCFG-ETH0.811

            DEVICE=eth0.811
            ONBOOT=yes # es el método para iniciar su interfaz de red (sí - automático, No - manual)
            BOOTPROTO=none #es cómo se asigna una dirección IP (estático es un valor introducido manualmente, DHCP significa que la dirección IP se asigna automáticamente)
            IPV6INIT=yes
            IPV6ADDR=2001:470:736b:811::4/64
            IPV6_DEFAULTGW=2001:470:736b:811::1
            VLAN=yes

        /ETC/RESOLV.CONF
            nameserver 2001:470:736b:820::2 ##UNBOUND

        /ETC/SYSCONFIG/NETWORK-SCRIPTS/IFCFG-ETH0

            IPV6_AUTOCONF="yes" => "no"

**************************************************************************
TODO: introducirlo en el fichero de los clientes
=======
        fichero /etc/sysctl.conf
            net.ipv6.conf.eth0.use_tempaddr=0
            net.ipv6.conf.eth0.autoconf=0
            net.ipv6.conf.eth0.accept_ra=0


Comandos útiles:

    RED:
        systemctl restart network

        nmcli -p dev #saca las interfaces de red

        ip a #saca las interfaces de manera mas extensa

    chronyc tracking
    systemctl restart chronyd
    chronyc sources
    chronyc makestep
    timedatectl
    systemctl enable chronyd para cuando se encienda
    timedatectl set-ntp true



    Relativos al ipa
        kinit admin
        ipa dnszone-find
        ipa dnsrecord-find 1.8.ff.es.eu.org. --name ipa2
        ipa dnsrecord-add
            Record name


ipapython.admintool: ERROR    Unable to resolve host name, check /etc/hosts or DNS name resolution
ipapython.admintool: ERROR    The ipa-replica-install command failed. See /var/log/ipareplica-install.log for more information



Enlaces de interes:

    https://martinfigueredo.com/administracion-de-interfaces-linux-centos/

    https://informaticamadridmayor.es/tips/configuracion-de-la-configuracion-de-red-en-rhel-centos/

    https://my.simplercloud.com/index.php?/knowledgebase/article/183/how-to-configure-static-ipv6-address-on-centos-/

    https://www.snel.com/support/how-to-configure-802-1q-vlan-tagging-on-centos-7/

    https://tinouy.com/2019/02/08/instalando-free-ipa

    https://access.redhat.com/documentation/es-es/red_hat_enterprise_linux/7/html/linux_domain_identity_authentication_and_policy_guide/installing-ipa

    https://ns1.com/blog/glue-records-and-dedicated-dns

    https://kb.rolosa.com/dns-forwarder-vs-dns-resolver/

    https://docs.sophos.com/nsg/sophos-utm/utm/9.708/help/en-us/Content/utm/utmAdminGuide/NetworkServicesDNSForwarders.htm

